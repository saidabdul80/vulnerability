<!DOCTYPE html>
<html>

<head>
    <title>Data Reports</title>
    <!-- Include Chart.js library and other dependencies -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
<script src="https://cdn.jsdelivr.net/npm/html2canvas"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/canvg/1.1/canvg.min.js" integrity="sha512-IqDpl6qmu6Tc4K1q6v/98X61sOBLurjwtOxA9K5eFJaEmX9fCeCiBq8PYer1QzAGQED25S2LEeSFOINo8O4S0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css" />
    <style>
        /* Define a fixed size for the chart container */
        .chart-container {
            width: 100%; /* Set the desired width */
            height: 400px; /* Set the desired height */
        }
    </style>
</head>

<body>
    <div class="container-fluid">

        <div class="px-5">
            <div class="partners">
                <img src="./img/partners.png" alt="" style="min-width:350px;height:90px;">
            </div>
        </div>
        <script>
             function lineChartBar(id, labels, data){
                        var wardData = {
                            labels:labels,
                            datasets: [{
                                data:data,
                                backgroundColor: ["#FF5733", "#33FF57", "#5733FF", "#FFC300"],
                            }],
                        };
    
                        // Doughnut chart options
                        var options = {                         
                            responsive: true,
                            maintainAspectRatio: false,
                            animation:{
                                animateRotate:false
                            }, plugins: {
                                legend: {
                                    display: false
                                },
                            datalabels: {
                                rotation: 270,
                                anchor: 'end',
                                align: 'top',
                                color: 'black',
                                font: {
                                    weight: 'bold',
                                },
                                padding: {
                                    bottom: 40
                                },
                                formatter: function(value, context) {
                                    if (value == 0) {
                                        return '';
                                    }
                                    return value
                                }
                            }
                        },                        
                        };
    
                        // Create the doughnut chart
                        var wardDoughnutChart = new Chart(document.getElementById(id).getContext('2d'), {
                            type: 'bar',
                            data: wardData,
                            options: options,
                        });
                    }
            
            function lineChart(id, labels, data){
                
                        var wardData = {
                            labels:labels,
                            datasets: [{
                                data:data,
                                backgroundColor: ["#FF5733", "#33FF57", "#5733FF", "#FFC300"],
                            }],
                        };
    
                        // Doughnut chart options
                        var options = {
                            
                            responsive: true,
                            maintainAspectRatio: false,
                            animation:{
                                animateRotate:false
                            }, plugins: {
                                legend: {
                                    display: false
                                },
                            datalabels: {
                                rotation: 270,
                                anchor: 'end',
                                align: 'top',
                                color: 'black',
                                font: {
                                    weight: 'bold',
                                },
                                padding: {
                                    bottom: 40
                                },
                                formatter: function(value, context) {
                                    if (value == 0) {
                                        return '';
                                    }
                                    return value
                                }
                            }
                        },                        
                        };
    
                        // Create the doughnut chart
                        var wardDoughnutChart = new Chart(document.getElementById(id).getContext('2d'), {
                            type: 'line',
                            data: wardData,
                            options: options,
                        });
                    }
            function createGroupedBarChart(id, data, groups, title) {
                // Data for the grouped bar chart
                var chartData = {
                    labels: groups,
                    datasets: data
                };

                // Grouped bar chart options
                var options = {
                    scales: {
                        y: {
                            beginAtZero: true, // Start the Y-axis at 0                            
                            stepSize: 5000, // Set the interval value (e.g., 10)
                            ticks: {
                                stepSize: 5000, // Set the interval value (e.g., 10)
                                precision: 0, // Set the number of decimal places for tick values
                            }
                        },
                    },
                    responsive: true,
                    tooltips: {
                        enabled: false
                    },
                    plugins: {
                        datalabels: {
                            rotation: 270,
                            anchor: 'end',
                            align: 'top',
                            color: 'black',
                            font: {
                                weight: 'bold',
                            },
                            padding: {
                                bottom: 40
                            },
                            formatter: function(value, context) {
                                if (value == 0) {
                                    return '';
                                }
                                return value
                            }
                        }
                    },
                };

                // Create the grouped bar chart\
                Chart.register(ChartDataLabels);
                var ctx = document.getElementById(id).getContext('2d');
                var chart = new Chart(document.getElementById(id).getContext('2d'), {
                    type: 'bar',
                    data: chartData,
                    options: options,
                });

            }
        </script>
        <!-- Pie Chart for "Poor" Category -->
        <div class="row mt-3 px-5">
            <div class="col-md-4">
                <h5>Total Captured: <span style="color:brown;font-weight:bolder"><?= number_format($total_captured); ?></span></h5>
                <h5></h5>
            </div>
            <div class="col-md-4">
                <h5>ZoneA:</h3>
                    <h5></h5>
            </div>
            <div class="col-md-4">
                <h5>Total Captured:</h5>
                <h5></h5>
            </div>
        </div>
        <div class="row">
            <div class="col-md-9">
                <div class="col-md-12 px-5 pt-5">


                    <h6 class="text-center">Distribution By Vulnerability Domains</h6>
                    <div style="padding:30px;box-shadow: rgba(0, 0, 0, 0.45) 0px 25px 20px -20px;">
                        <canvas id="groupedBarChart" width="800" height="400" title="Grouped Categories"></canvas>
                    </div>
                    
                </div>

                <script>
                    var categories = ['Disability', 'Elderly', 'Poor', 'Sex Workers & Truck Driver', 'IDP', 'Women & Children Under 5', 'Others'];
                    var data = [{
                            label: 'Low',
                            data: [<?= $disability->q25 ?>, <?= $elderly->q25 ?>, <?= $poor->q25 ?>, <?= $sex_worker_truck_driver->q25 ?>, <?= $IDP->q25 ?>, <?= $women_children_under_5->q25 ?>, <?= $other->q25 ?>],
                            backgroundColor: "#bbb",
                        },
                        {
                            label: 'Medium',
                            data: [<?= $disability->median ?>, <?= $elderly->median ?>, <?= $poor->median ?>, <?= $sex_worker_truck_driver->median ?>, <?= $IDP->median ?>, <?= $women_children_under_5->median ?>, <?= $other->median ?>],
                            backgroundColor: "#fdaa14",
                        },
                        {
                            label: 'High',
                            data: [<?= $disability->q75 ?>, <?= $elderly->q75 ?>, <?= $poor->q75 ?>, <?= $sex_worker_truck_driver->q75 ?>, <?= $IDP->q75 ?>, <?= $women_children_under_5->q75 ?>, <?= $women_children_under_5->q75 ?>],
                            backgroundColor: "#fc1545",
                        }
                    ];

                    createGroupedBarChart("groupedBarChart", data, categories, 'Grouped Categories');
                     // Function to export the chart as an SVG
                    document.getElementById('exportChart').addEventListener('click', function () {
                        var canvas = document.getElementById('groupedBarChartGender');
                        html2canvas(canvas).then(function (canvas) {
                            var svgData = canvg('svg', canvas.toDataURL('image/png'));
                            var a = document.createElement('a');
                            a.href = 'data:image/svg+xml;base64,' + btoa(svgData.outerHTML);
                            a.download = 'chart.svg';
                            a.click();
                        });
                    });
                </script>
            </div>
            <div class="col-md-3">
                <h6 class="text-center">Distribution By LGAs</h6>
                <div style="height: 500px;overflow-y:auto">

                    <table class="w-100 table">
                        <thead>
                            <tr>
                                <td style="padding:2px !important;">L.G.A</td>
                                <td style="padding:2px !important;">Count</td>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach($lgas as $lga)
                            @if($lga->lga != '')
                            <tr>
                                <td class="pt-1" style="padding-top:2px !important; font-size:14px">{{$lga->lga}}</td>
                                <td class="pt-1" style="padding-top:2px !important; font-size:14px">{{$lga->total}}</td>
                            </tr>
                            @endif
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row px-5">
            <div class="col-md-7">
                <div class="col-md-12 px-5 pt-5">


                    <h6 class="text-center">Distribution By Vulnerability Gender</h6>
                    <div style="padding:30px;box-shadow: rgba(0, 0, 0, 0.45) 0px 25px 20px -20px;">
                        <canvas id="groupedBarChartGender" width="800" height="400" title="Grouped Categories"></canvas>
                    </div>
                    <script>
                    var categories = ['Male', 'Female'];
                    var data = [{
                            label: 'Low',
                            data: [<?= $male_dist->q25 ?>, <?= $female_dist->q25 ?>],
                            backgroundColor: "#bbb",
                        },
                        {
                            label: 'Medium',
                            data: [<?= $male_dist->median ?>, <?= $female_dist->median ?>],
                            backgroundColor: "#fdaa14",
                        },
                        {
                            label: 'High',
                            data: [<?= $male_dist->q75 ?>, <?= $female_dist->q75 ?>],
                            backgroundColor: "#fc1545",
                        }
                    ];

                    createGroupedBarChart("groupedBarChartGender", data, categories, 'Grouped Categories');
                </script>
                </div>
            </div>   
            <div class="col-md-12 mt-5">
                <h6 class="text-center">Distribution By LGAs</h6>
                <div class="chart-container">
                <canvas id="wardDoughnutChart" width="400" height="400"></canvas>
                </div>
                <script>
                    lineChart('wardDoughnutChart',<?= json_encode(collect($lgas)->pluck('lga')); ?>, <?= json_encode(collect($lgas)->pluck('total')) ?>)                                        
                </script>
            </div>  
            <?php $i = 0 ?>
            @foreach($wards_lga as $key=> $ward)

            <div class="col-md-4 mt-5" >
                <h6 class="text-center">Distribution By {{$key}}</h6>
                <div class="chart-container">
                <canvas id="wardChart{{$key}}" width="400" height="400"></canvas>
                </div>
                <script>
                    lineChartBar('wardChart{{$key}}',<?= json_encode(collect($ward)->pluck('ward')->toArray()); ?>, <?= json_encode(collect($ward)->pluck('total')->toArray()) ?>)                                        
                </script>
            </div>  
            @endforeach
        </div>
        <!-- Call the function to create the "Elderly" category pie chart -->

        <!-- Repeat this structure for other categories as needed -->
    </div>
</body>

</html>