<?php

use App\Models\LGA;

$lgas = LGA::with('wards')->get();
?>

@extends('layouts.app')

@section('content')
    <div class="container mx-auto p-4" id="app">
        <div class="mb-4">
            <h2 class="text-2xl font-bold mb-4">Upload Excel Data to Users Table</h2>
            <form action="{{ route('import.excel') }}" method="POST" enctype="multipart/form-data" class="mb-4">
                @csrf
                <label for="file" class="block text-gray-700">Choose Excel File</label>
                <input required type="file" name="file" accept=".xls, .xlsx" class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500">
                <button type="submit" class="mt-4 bg-blue-500 text-white py-2 px-4 rounded hover-bg-blue-700 focus:outline-none focus:bg-blue-700">Upload</button>
            </form>
        </div>
        <div class="w-[100%] md:w-[400px]">
            <h2 class="text-2xl font-bold mb-4">Add Users</h2>
            <form action="{{ route('add.users') }}" method="POST" class="mb-4">
                @csrf
                <div class="mb-4">
                    <label for="name" class="block text-gray-700">Name</label>
                    <input required type="text" name="name" class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500">
                </div>
                <div class="mb-4">
                    <label for="email" class="block text-gray-700">Email</label>
                    <input required type="email" name="email" class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500">
                </div>
                <div class="mb-4">
                <label for="gender" class="block text-gray-700">Gender</label>
                <select required name="gender" class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
                </div>
                <div class="mb-4">
                    <label for="age" class="block text-gray-700">Age</label>
                    <input required type="number" name="age" class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500">
                </div>
                <div class="mb-4">
                    <label for="lga_id" class="block text-gray-700">Select LGA</label>
                    <select required name="lga_id" class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500" v-model="selectedLGA">
                        <option value="">Select an LGA</option>
                        @foreach($lgas as $lga)
                            <option value="{{ $lga->id }}">{{ $lga->lga }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="mb-4">
                    <label for="ward_ids" class="block text-gray-700">Select Wards (Multi-Select)</label>
                    <select required name="ward_ids[]" class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500" multiple>
                        <option v-for="ward in selectedLGAWards" :value="ward.id">@{{ ward.ward }}</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="phone_number" class="block text-gray-700">Phone Number</label>
                    <input required type="text" name="phone_number" class="w-full py-2 px-3 border border-gray-300 rounded focus:outline-none focus:border-blue-500">
                </div>
                <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded hover-bg-blue-700 focus:outline-none focus:bg-blue-700">Add User</button>
            </form>
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

createApp({
    data() {
        return {
            selectedLGA: '',
            lgas: {!! json_encode($lgas) !!}
        };
    },
    computed: {
        selectedLGAWards: function () {
            const lga = this.lgas.find(lga => lga.id == this.selectedLGA);
            return lga ? lga.wards : [];
        }
    },
}).mount('#app');
</script>
@endsection
